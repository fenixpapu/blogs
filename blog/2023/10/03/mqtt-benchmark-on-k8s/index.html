
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../09/27/jenkins-for-dummies/">
      
      
        <link rel="next" href="../../09/deploy-aws-lambda-from-terminal/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.webp">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.4">
    
    
      
        <title>MQTT benchmark on k8s - PaPu</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mqtt-benchmark-on-k8s" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="PaPu" class="md-header__button md-logo" aria-label="PaPu" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M543.8 287.6c17 0 32-14 32-32.1 1-9-3-17-11-24L512 185V64c0-17.7-14.3-32-32-32h-32c-17.7 0-32 14.3-32 32v36.7L309.5 7c-6-5-14-7-21-7s-15 1-22 8L10 231.5c-7 7-10 15-10 24 0 18 14 32.1 32 32.1h32v69.7c-.1.9-.1 1.8-.1 2.8V472c0 22.1 17.9 40 40 40h16c1.2 0 2.4-.1 3.6-.2 1.5.1 3 .2 4.5.2h56c22.1 0 40-17.9 40-40v-88c0-17.7 14.3-32 32-32h64c17.7 0 32 14.3 32 32v88c0 22.1 17.9 40 40 40h56.5c1.4 0 2.8 0 4.2-.1 1.1.1 2.2.1 3.3.1h16c22.1 0 40-17.9 40-40v-16.2c.3-2.6.5-5.3.5-8.1l-.7-160.2h32z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PaPu
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MQTT benchmark on k8s
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/fenixpapu/blogs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    fenixpapu/blogs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="PaPu" class="md-nav__button md-logo" aria-label="PaPu" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M543.8 287.6c17 0 32-14 32-32.1 1-9-3-17-11-24L512 185V64c0-17.7-14.3-32-32-32h-32c-17.7 0-32 14.3-32 32v36.7L309.5 7c-6-5-14-7-21-7s-15 1-22 8L10 231.5c-7 7-10 15-10 24 0 18 14 32.1 32 32.1h32v69.7c-.1.9-.1 1.8-.1 2.8V472c0 22.1 17.9 40 40 40h16c1.2 0 2.4-.1 3.6-.2 1.5.1 3 .2 4.5.2h56c22.1 0 40-17.9 40-40v-88c0-17.7 14.3-32 32-32h64c17.7 0 32 14.3 32 32v88c0 22.1 17.9 40 40 40h56.5c1.4 0 2.8 0 4.2-.1 1.1.1 2.2.1 3.3.1h16c22.1 0 40-17.9 40-40v-16.2c.3-2.6.5-5.3.5-8.1l-.7-160.2h32z"/></svg>

    </a>
    PaPu
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/fenixpapu/blogs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    fenixpapu/blogs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/dev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dev
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    devops
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/general/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    general
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/linh-tinh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linh tinh
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/math/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    math
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://avatars.githubusercontent.com/u/38837950?v=4" alt="PaPu">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          <a href="github.com/fenixpapu">PaPu</a>
                        
                      </strong>
                      <br>
                      Passio without N
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                        <time datetime="2023-10-03 00:00:00" class="md-ellipsis">Oct 3, 2023</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../../../../category/devops/">devops</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                          <span class="md-ellipsis">
                            
                              9 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server-estimate" class="md-nav__link">
    <span class="md-ellipsis">
      Server estimate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-can-bang-tai-emqx" class="md-nav__link">
    <span class="md-ellipsis">
      Test cân bằng tải EMQX
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test cân bằng tải EMQX">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emqx-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      EMQX cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emqx-bench" class="md-nav__link">
    <span class="md-ellipsis">
      EMQX-bench
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nhan-xet" class="md-nav__link">
    <span class="md-ellipsis">
      Nhận xét
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        

  
  


<h1 id="mqtt-benchmark-on-k8s">MQTT benchmark on k8s</h1>
<ul>
<li>Mình join support BID 1 dự án, và về lý thuyết MQTT support scale và loadbalancing (chi tiết xem doc EMQX: <a href="https://www.emqx.io/docs/en/v5.0/deploy/cluster/lb.html#configure-haproxy-nginx-in-emqx">configure load balancer</a> ) nhưng để chắc chắn mình cần test trước để biết behavior của nó là như thế nào sau đó estimate mới chuẩn được.</li>
</ul>
<!-- more -->

<h2 id="server-estimate">Server estimate</h2>
<ul>
<li>
<p>EMQX có <a href="https://www.emqx.com/en/server-estimate">server estimate</a> ở đây. Tức sẽ estimate cho mình với resource của server như nào ( ví dụ 1 CPU, 1G RAM) mình sẽ phục vụ được bao nhiêu connection và pub&amp;sub TPS (total per second).</p>
</li>
<li>
<p>Nên mình cũng test lại xem pub&amp;sub thực tế có giống như trang của EMQX đưa ra ko( còn nhiều tham số khác ảnh hưởng đến kết quả test mà EMQX chưa đưa ra nên cần test lại ví dụ như đã off SSL chưa, size của mess là lớn hay nhỏ: các tham số này đều ảnh hưởng đến kết quả bao nhiêu pub&amp;sub cùng lúc)</p>
</li>
<li>
<p>Trang chủ EMQX có sẵn <a href="https://www.emqx.io/docs/en/v5.0/deploy/install-docker.html#use-docker-compose-to-build-an-emqx-cluster">docker-compose</a> cho EMQX cluster. Paste lại đây trong trường hợp link chết :D</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docker-compose.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>version: &quot;3&quot;
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>services:
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>  emqx1:
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>    image: emqx:5.0.26
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>    container_name: emqx1
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    environment:
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>      - &quot;EMQX_NODE_NAME=emqx@node1.emqx.io&quot;
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>      - &quot;EMQX_CLUSTER__DISCOVERY_STRATEGY=static&quot;
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>      - &quot;EMQX_CLUSTER__STATIC__SEEDS=[emqx@node1.emqx.io,emqx@node2.emqx.io]&quot;
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    healthcheck:
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>      test: [&quot;CMD&quot;, &quot;/opt/emqx/bin/emqx_ctl&quot;, &quot;status&quot;]
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>      interval: 5s
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>      timeout: 25s
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>      retries: 5
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    networks:
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>      emqx-bridge:
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>        aliases:
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>          - node1.emqx.io
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    ports:
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>      - 1883:1883
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>      - 8083:8083
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>      - 8084:8084
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>      - 8883:8883
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>      - 18083:18083
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    # volumes:
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    #   - $PWD/emqx1_data:/opt/emqx/data
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>  emqx2:
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    image: emqx:5.0.26
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    container_name: emqx2
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    environment:
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>      - &quot;EMQX_NODE_NAME=emqx@node2.emqx.io&quot;
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>      - &quot;EMQX_CLUSTER__DISCOVERY_STRATEGY=static&quot;
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>      - &quot;EMQX_CLUSTER__STATIC__SEEDS=[emqx@node1.emqx.io,emqx@node2.emqx.io]&quot;
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    healthcheck:
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>      test: [&quot;CMD&quot;, &quot;/opt/emqx/bin/emqx_ctl&quot;, &quot;status&quot;]
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>      interval: 5s
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>      timeout: 25s
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>      retries: 5
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    networks:
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>      emqx-bridge:
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        aliases:
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>          - node2.emqx.io
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    # volumes:
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    #   - $PWD/emqx2_data:/opt/emqx/data
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>networks:
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>  emqx-bridge:
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    driver: bridge
</code></pre></div></td></tr></table></div>
<ul>
<li><code>docker compose up -d</code> và thế là mình có 1 cluster EMQX để test rồi.</li>
<li>
<p>Giờ đến test tải. EMQX cũng support sẵn dockerize cho việc bench connection, pub, sub chỉ việc docker run là có ở đây: <a href="https://hub.docker.com/r/emqx/emqtt-bench">EMQTT-bench</a></p>
</li>
<li>
<p>Ví dụ giờ muốn test connection mình có thể chạy câu lệnh sau: <code>docker run -it emqx/emqtt-bench conn -c 50000 -i 10</code></p>
</li>
<li>
<p>BOOM nhưng *ÉO. Sau khi chạy lệnh nó méo work. Dù docker-compose kia mình đã sửa để expose và port ra local (truy cập được dashboard) nhưng EMQTT-bench thì lại không work.</p>
</li>
<li>
<p>Ngáo ngơ một hồi nhớ ra bản thân con EMQTT-bench cũng chạy trong container nên ko thể là <code>-h localhost</code>. Vì mình đã expose EMQTT cluster ra local nên giờ cần đổi <code>-h localhost</code> thành <code>-h host_IP</code>. Container EMQX-bench nhận localhost là localhost của nó chứ ko phải của host đang chạy docker.</p>
</li>
<li>
<p>Ok sau khi đã sửa tham số và đã có thể test tải ok. Lệnh pub&amp;sub trông sẽ ntn (nhớ thử với thông số nhỏ trước nhé vì có thể lỗi, thay bằng số lớn sau):</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span>
<span class="normal"><a href="#__codelineno-1-7">7</a></span>
<span class="normal"><a href="#__codelineno-1-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a># pub 1
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>docker run -it emqx/emqtt-bench pub -c 1 -I 1 -t bench/%i -q 2 -h 10.20.0.232 -q 2
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a># pub 1k
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>docker run -it emqx/emqtt-bench pub -c 1000 -I 1000 -t bench/%i -h 10.20.0.232 -q 2
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a># sub 1k
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>docker run -it emqx/emqtt-bench sub -c 1000 -i 1000 -t bench/%i -q 2 -h 10.20.0.232 -q 2
</code></pre></div></td></tr></table></div>
<ul>
<li><code>10.20.0.232</code> là IP của host chạy docker được 1 EMQTT expose ra.</li>
<li>Vấn đề phát sinh dù có 3 con EMQTT nhưng tải chỉ ăn 1 con (do mình expose 1 IP của node EMQX - nhưng dù có expose hết thì cũng chưa có biện pháp cân bằng tải nào ở đây cả). Phần tiếp theo check cân bằng tải</li>
</ul>
<h2 id="test-can-bang-tai-emqx">Test cân bằng tải EMQX</h2>
<h3 id="emqx-cluster">EMQX cluster</h3>
<ul>
<li>
<p>Về mặt lý thuyết với docker-compose trên và hướng dẫn <a href="https://www.emqx.io/docs/en/v5.0/deploy/cluster/lb.html">configure load balancer</a> có thể dùng nginx hoặc HA proxy để test loadbalancing. Nhưng loay hoay mãi méo thành công(cái này do mình kém - mà thôi méo có thời gian check). Trong khi KHG đang dùng helm và call internal service trong k8s nên mình quyết định test như của khách luôn :D</p>
</li>
<li>
<p>Mình chạy minikube để có cụm k8s local. Và khách hàng dùng <a href="https://github.com/emqx/emqx/tree/master/deploy/charts/emqx#installing-the-chart">helm</a> này để cài EMQX</p>
</li>
<li>
<p>Kéo code về rồi sửa version trong Chart.yaml thành <code>5.0.8</code> như của khách rồi chạy thôi để có EMQX cluster trong k8s:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>$ git clone https://github.com/emqx/emqx.git
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>$ cd emqx/deploy/charts/emqx
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>$ helm install my-emqx .
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a># Xoá đi test lại :D dùng:
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>$ helm del my-emqx
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>Sau khi chờ 1 chút chúng ta sẽ có 3 pods ở namespace default (cấu hình trong <code>StatefulSets</code> không phải trong deployment đâu mà tìm :D)</p>
</li>
<li>
<p>Để truy cập dashboard của EMQX chúng ta cần expose port của EMQX ra local với lệnh:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>kubectl port-forward svc/my-emqx 18083:18083
</code></pre></div></td></tr></table></div>
<ul>
<li>Note: máy mình chỉ có 1 config k8s (minikube) nếu máy có nhiều config của k8s cluster thì cần chọn lại đúng cluster mong muốn trước khi chạy kubectl (chạy như nào gg :D)</li>
<li>Sau đó chúng ta có thể truy cập địa chỉ: <code>localhost:18083</code> để vào EMQX dashboard trông nó sẽ ntn:
  <img alt="EQMX cluster dashboard" src="../../../../images/2023/20231004-EMQX-cluster-dashboard.png" /></li>
</ul>
<h3 id="emqx-bench">EMQX-bench</h3>
<ul>
<li>
<p>Cluster EMQX có rồi giờ đến EMQX-bench. Đến phần khó: EMQX-bench trên docker hub hướng dẫn chạy với lệnh ví dụ:
  <code>docker run -it emqx/emqtt-bench conn -c 50000 -i 10</code> tức chạy container với images <code>emqx/emqtt-bench</code> với lệnh: <code>conn -c 50000 -i 10</code>.</p>
</li>
<li>
<p>Giờ muốn chạy test pub/sub mình thử tạo deployment với lệnh tương ứng như trên nhưng ko work( ko tin thử thì biết :D)</p>
</li>
<li>
<p>Sau đó nhớ ra có thể check docker entry point vì có thể nó đã bị thay đổi. (Cảm ơn Docker In Action - Mình biết trò này của docker qua quyển này - sẽ có một bài note lại về quyển này. Spoiler ko cần đọc hết cả quyển)</p>
</li>
<li>
<p>Check ra thấy entry point đã bị thay đổi như này:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span>
<span class="normal"><a href="#__codelineno-4-35">35</a></span>
<span class="normal"><a href="#__codelineno-4-36">36</a></span>
<span class="normal"><a href="#__codelineno-4-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>papu@cyber:~$ docker history emqx/emqtt-bench
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>IMAGE          CREATED        CREATED BY                                      SIZE      COMMENT
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>9c87dc50902a   8 weeks ago    CMD [&quot;&quot;]                                        0B        buildkit.dockerfile.v0
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>&lt;missing&gt;      8 weeks ago    ENTRYPOINT [&quot;/emqtt_bench/emqtt_bench&quot;]         0B        buildkit.dockerfile.v0
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>&lt;missing&gt;      8 weeks ago    RUN /bin/sh -c make compile # buildkit          536MB     buildkit.dockerfile.v0
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>&lt;missing&gt;      8 weeks ago    WORKDIR /emqtt_bench                            0B        buildkit.dockerfile.v0
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>&lt;missing&gt;      8 weeks ago    COPY . /emqtt_bench # buildkit                  2.83MB    buildkit.dockerfile.v0
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>&lt;missing&gt;      2 months ago   CMD [&quot;/bin/bash&quot;]                               0B        buildkit.dockerfile.v0
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>&lt;missing&gt;      2 months ago   WORKDIR /                                       0B        buildkit.dockerfile.v0
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>&lt;missing&gt;      2 months ago   RUN |4 OTP_VERSION=25.3.2-1 ELIXIR_VERSION=1…   1.21MB    buildkit.dockerfile.v0
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>&lt;missing&gt;      2 months ago   ENV LUX_REF=lux-2.6                             0B        buildkit.dockerfile.v0
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>&lt;missing&gt;      2 months ago   ARG LUX_REF                                     0B        buildkit.dockerfile.v0
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>&lt;missing&gt;      2 months ago   RUN |3 OTP_VERSION=25.3.2-1 ELIXIR_VERSION=1…   9.13MB    buildkit.dockerfile.v0
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>&lt;missing&gt;      2 months ago   COPY get-emqtt-bench.sh /get-emqtt-bench.sh …   882B      buildkit.dockerfile.v0
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>&lt;missing&gt;      2 months ago   ARG EMQTT_BENCH_REF                             0B        buildkit.dockerfile.v0
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>&lt;missing&gt;      2 months ago   RUN |2 OTP_VERSION=25.3.2-1 ELIXIR_VERSION=1…   0B        buildkit.dockerfile.v0
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>&lt;missing&gt;      2 months ago   RUN |2 OTP_VERSION=25.3.2-1 ELIXIR_VERSION=1…   6.96MB    buildkit.dockerfile.v0
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>&lt;missing&gt;      2 months ago   COPY get-elixir.sh /get-elixir.sh # buildkit    786B      buildkit.dockerfile.v0
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>&lt;missing&gt;      2 months ago   ARG ELIXIR_VERSION                              0B        buildkit.dockerfile.v0
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>&lt;missing&gt;      2 months ago   RUN |1 OTP_VERSION=25.3.2-1 /bin/sh -c /get-…   156MB     buildkit.dockerfile.v0
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>&lt;missing&gt;      2 months ago   COPY get-otp.sh /get-otp.sh # buildkit          2.18kB    buildkit.dockerfile.v0
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>&lt;missing&gt;      2 months ago   ARG OTP_VERSION                                 0B        buildkit.dockerfile.v0
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>&lt;missing&gt;      2 months ago   ENV EMQX_BUILDER_IMAGE=                         0B        buildkit.dockerfile.v0
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>&lt;missing&gt;      2 months ago   CMD [&quot;/bin/bash&quot;]                               0B        buildkit.dockerfile.v0
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>&lt;missing&gt;      2 months ago   WORKDIR /                                       0B        buildkit.dockerfile.v0
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>&lt;missing&gt;      2 months ago   ENV LANG=C.UTF-8                                0B        buildkit.dockerfile.v0
<a id="__codelineno-4-27" name="__codelineno-4-27"></a>&lt;missing&gt;      2 months ago   ENV LC_ALL=C.UTF-8                              0B        buildkit.dockerfile.v0
<a id="__codelineno-4-28" name="__codelineno-4-28"></a>&lt;missing&gt;      2 months ago   RUN /bin/sh -c apt-get clean &amp;&amp; rm -rf /var/…   0B        buildkit.dockerfile.v0
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>&lt;missing&gt;      2 months ago   RUN /bin/sh -c /get-cmake.sh build # buildkit   55.7MB    buildkit.dockerfile.v0
<a id="__codelineno-4-30" name="__codelineno-4-30"></a>&lt;missing&gt;      2 months ago   COPY get-cmake.sh /get-cmake.sh # buildkit      800B      buildkit.dockerfile.v0
<a id="__codelineno-4-31" name="__codelineno-4-31"></a>&lt;missing&gt;      2 months ago   RUN /bin/sh -c ln -sf /usr/bin/pip3 /usr/bin…   13B       buildkit.dockerfile.v0
<a id="__codelineno-4-32" name="__codelineno-4-32"></a>&lt;missing&gt;      2 months ago   RUN /bin/sh -c ln -sf /usr/bin/python3 /usr/…   16B       buildkit.dockerfile.v0
<a id="__codelineno-4-33" name="__codelineno-4-33"></a>&lt;missing&gt;      2 months ago   RUN /bin/sh -c apt-get install -y     krb5-k…   14.6MB    buildkit.dockerfile.v0
<a id="__codelineno-4-34" name="__codelineno-4-34"></a>&lt;missing&gt;      2 months ago   RUN /bin/sh -c apt-get update &amp;&amp; apt-get ins…   576MB     buildkit.dockerfile.v0
<a id="__codelineno-4-35" name="__codelineno-4-35"></a>&lt;missing&gt;      2 months ago   ENV DEBIAN_FRONTEND=noninteractive              0B        buildkit.dockerfile.v0
<a id="__codelineno-4-36" name="__codelineno-4-36"></a>&lt;missing&gt;      3 months ago   /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B
<a id="__codelineno-4-37" name="__codelineno-4-37"></a>&lt;missing&gt;      3 months ago   /bin/sh -c #(nop) ADD file:b7c0be2bb90e88689…   124MB
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>Để ý lệnh thứ 2: <code>ENTRYPOINT ["/emqtt_bench/emqtt_bench"]</code> đó entry point đã bị đổi mặc định sẽ chạy lệnh này tức cụm <code>conn -c 50000 -i 10</code> chỉ là tham số (arguments) thôi.</p>
</li>
<li>
<p>Mình tạo luôn 2 file deployment apply cho nhanh (ko phải helm):</p>
</li>
<li>
<p>pub-deployment-EMQX-bench.yml:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">pub-deployment-EMQX-bench.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span>
<span class="normal"><a href="#__codelineno-5-31">31</a></span>
<span class="normal"><a href="#__codelineno-5-32">32</a></span>
<span class="normal"><a href="#__codelineno-5-33">33</a></span>
<span class="normal"><a href="#__codelineno-5-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx-bench-deployment</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx-bench</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx-bench</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx-bench</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx-bench</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx/emqtt-bench:latest</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w">          </span><span class="nt">command</span><span class="p">:</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="w">            </span><span class="p p-Indicator">[</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w">              </span><span class="s">&quot;emqtt_bench&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w">              </span><span class="s">&quot;pub&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">              </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="w">              </span><span class="s">&quot;500&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="w">              </span><span class="s">&quot;-I&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="w">              </span><span class="s">&quot;500&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="w">              </span><span class="s">&quot;-t&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="w">              </span><span class="s">&quot;bench/%i&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="w">              </span><span class="s">&quot;-q&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="w">              </span><span class="s">&quot;2&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="w">              </span><span class="s">&quot;-h&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="w">              </span><span class="s">&quot;my-emqx.default.svc.cluster.local&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="w">            </span><span class="p p-Indicator">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>sub-deployment-EMQX-bench.yaml</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">sub-deployment-EMQX-bench.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx-bench-sub-deployment</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx-bench</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx-bench</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx-bench</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx-bench</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">emqx/emqtt-bench:latest</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">          </span><span class="nt">command</span><span class="p">:</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">            </span><span class="p p-Indicator">[</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">              </span><span class="s">&quot;emqtt_bench&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">              </span><span class="s">&quot;sub&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">              </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">              </span><span class="s">&quot;500&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">              </span><span class="s">&quot;-i&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">              </span><span class="s">&quot;500&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">              </span><span class="s">&quot;-t&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">              </span><span class="s">&quot;bench/%i&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">              </span><span class="s">&quot;-q&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="w">              </span><span class="s">&quot;2&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="w">              </span><span class="s">&quot;-h&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="w">              </span><span class="s">&quot;my-emqx.default.svc.cluster.local&quot;</span><span class="p p-Indicator">,</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">            </span><span class="p p-Indicator">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>Note:</p>
</li>
<li>
<p>Trong file deployment mình đã thêm phần <code>command</code> để thực hiện việc bench test</p>
</li>
<li>
<p>Nếu đọc bạn sẽ thấy phần <code>-h</code> với giá trị: <code>my-emqx.default.svc.cluster.local</code> do pub và sub mình định deploy trong cùng 1 namespace (default) với emqx cluster.</p>
</li>
<li>
<p>Khi chạy thử pub lên đã thấy share tải. (Mình thử mở thêm 1 pod EMQX trong EMQX cluster nữa( từ 3 lên 4) thì thấy mãi ko join cluster ( trước đó mình test join thành công). Check lỗi thấy liên quan port 18083. Tắt bỏ cái port forward ở trên thì join thành công. -&gt; Cần lưu ý việc này khi test :D )</p>
</li>
</ul>
<h3 id="nhan-xet">Nhận xét</h3>
<ul>
<li>
<p>Khi có 3 nodes trong EMQX cluster, và 1 pod của EMQX-bench thì có share tải. Nhưng khi mình scale tay lên node thứ 4 thì node 4 này ko chịu tải ( ko có request nào tới). Khi chạy thêm pod thứ hai của EMQX-bench thì node thứ 4 mới chịu tải ==&gt; :</p>
</li>
<li>
<p><img alt="node-4th" src="../../../../images/2023/20231004-EMQX-cluster-node-4th.png" /></p>
</li>
<li>
<p>Việc scale phải setup trước khi quá tải, khi quá tải rồi add thêm node mới không có ý nghĩa với lượng tải hiện tại. Chỉ có ý nghĩa với những mess từ publisher mới.</p>
</li>
<li>
<p>Nhìn vào số lượng topic và connection hơn 100 của node số 4 trong khi các node cũ &gt; 200 ~ 300 -&gt; việc cân bằng tải service của k8s ko thực sự chính xác ( nó ko có cách nào biết mỗi node đang chịu tải bao nhiêu), nó chỉ thực sự chia đều các mess mới đến. -&gt; nếu muốn cân bằng tải khi auto scale cần nghiên cứu thêm. Server k8s chỉ chia để in comming mess thôi.</p>
</li>
<li>
<p>Chắc tạm đến đây hehe</p>
</li>
<li>
<p><strong><em> HAPPY WORKING!!!</em></strong></p>
</li>
</ul>







  
  




  



      
    </article>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 <a href="https://github.com/fenixpapu"  target="_blank" rel="noopener">PaPu</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/fenixpapu" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/phoenixpapu" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/fenixpapu/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.tabs", "navigation.indexes", "navigation.top", "toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../../../../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.7389ff0e.min.js"></script>
      
    
  </body>
</html>