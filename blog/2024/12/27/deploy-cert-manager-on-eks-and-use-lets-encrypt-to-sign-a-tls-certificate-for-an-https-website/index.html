
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../10/aws-assume-role/">
      
      
        <link rel="next" href="../../../../2025/01/06/til-terraform-providers-configuration-eks-platform-version-and-mac-m-series-issues/">
      
      
        
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.webp">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Deploy cert-manager on EKS and use Let's encrypt to sign a TLS certificate for an HTTPS website - PaPu</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deploy-cert-manager-on-eks-and-use-lets-encrypt-to-sign-a-tls-certificate-for-an-https-website" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="PaPu" class="md-header__button md-logo" aria-label="PaPu" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M234.2 8.6c12.3-11.4 31.3-11.4 43.5 0L368 92.3V80c0-17.7 14.3-32 32-32h32c17.7 0 32 14.3 32 32v101.5l37.8 35.1c9.6 9 12.8 22.9 8 35.1S493.2 272 480 272h-16v176c0 35.3-28.7 64-64 64H112c-35.3 0-64-28.7-64-64V272H32c-13.2 0-25-8.1-29.8-20.3s-1.6-26.2 8-35.1zM240 320c-26.5 0-48 21.5-48 48v96h128v-96c0-26.5-21.5-48-48-48z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PaPu
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deploy cert-manager on EKS and use Let's encrypt to sign a TLS certificate for an HTTPS website
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/fenixpapu/blogs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    fenixpapu/blogs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="PaPu" class="md-nav__button md-logo" aria-label="PaPu" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M234.2 8.6c12.3-11.4 31.3-11.4 43.5 0L368 92.3V80c0-17.7 14.3-32 32-32h32c17.7 0 32 14.3 32 32v101.5l37.8 35.1c9.6 9 12.8 22.9 8 35.1S493.2 272 480 272h-16v176c0 35.3-28.7 64-64 64H112c-35.3 0-64-28.7-64-64V272H32c-13.2 0-25-8.1-29.8-20.3s-1.6-26.2 8-35.1zM240 320c-26.5 0-48 21.5-48 48v96h128v-96c0-26.5-21.5-48-48-48z"/></svg>

    </a>
    PaPu
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/fenixpapu/blogs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    fenixpapu/blogs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2019
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/dev/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dev
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/devops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    devops
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/general/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    general
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/linh-tinh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    linh tinh
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/math/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    math
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    python
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/terraform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    terraform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://avatars.githubusercontent.com/u/38837950?v=4" alt="PaPu">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          <a href="../../../../../github.com/fenixpapu">PaPu</a>
                        
                      </strong>
                      <br>
                      Passio without N
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2024-12-27 00:00:00+00:00" class="md-ellipsis">Dec 27, 2024</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../../../../category/devops/">devops</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              12 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#part-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 1
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cau-hinh-aws-cli" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cấu hình AWS CLI
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-mot-public-domain-name" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tạo một public domain name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tao-eks-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tạo EKS cluster
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-cert-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install cert-manager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-test-clusterissuer-and-a-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create a test ClusterIssuer and a Certificate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-a-sample-web-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deploy a sample web server
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 2
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-an-iam-oidc-provider-for-your-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create an IAM OIDC provider for your cluster
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-an-iam-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create an IAM policy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-an-iam-role-and-associate-it-with-a-kubernetes-service-account" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create an IAM role and associate it with a Kubernetes service account
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grant-permission-for-cert-manager-to-create-serviceaccount-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      
        Grant permission for cert-manager to create ServiceAccount tokens
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-clusterissuer-for-lets-encrypt-staging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create a ClusterIssuer for Let's Encrypt Staging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#re-issue-the-certificate-using-lets-encrypt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Re-issue the Certificate using Let's Encrypt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-production-ready-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create a production ready certificate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      
        Clean Up
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  



  
  


<h1 id="deploy-cert-manager-on-eks-and-use-lets-encrypt-to-sign-a-tls-certificate-for-an-https-website">Deploy cert-manager on EKS and use Let's encrypt to sign a TLS certificate for an HTTPS website</h1>
<ul>
<li>Bài gốc ở trang của <a href="https://cert-manager.io/docs/tutorials/getting-started-aws-letsencrypt/#create-a-production-ready-certificate">cert-manager</a>, bài này chi tiết rõ ràng nên mình dịch lại ở đây :D.</li>
<li>Trong link có cả cho GCP, Azure có thể tham khảo nếu cần.</li>
<li>Trong bài này chúng ta sẽ học cách: deploy, cấu hình <code>cert-manager</code> trên EKS và cách deploy một HTTPS web server sau đó đưa nó lên internet.</li>
<li>Chúng ta cũng sẽ học cấu hình <code>cert-manager</code> để lấy được một signed certificate từ Let's Encrypt và dùng cert này cho phép người dùng kết nối với web của chúng ta một cách bảo mật.</li>
<li>Chúng ta sẽ cấu hình <code>cert-manager</code> sử dụng: <a href="https://letsencrypt.org/docs/challenge-types/#dns-01-challenge">Let's Encrypt DNS-01 challenge protocol</a> cùng với AWS Route53 DNS. Chúng ta sẽ dùng service account để xác thực với Route53.</li>
</ul>
<!-- more -->

<ul>
<li>Để lấy được cert từ Let's Encrypt chúng ta có <a href="https://letsencrypt.org/docs/challenge-types/">hai cách</a>: HTTP-01 challenge hoặc DNS-01 challenge trong bài này sẽ dùng DNS-01.</li>
</ul>
<h2 id="part-1">Part 1</h2>
<ul>
<li>Phần này sẽ thực hiện các bước cơ bản cần làm để deploy HTTPS websites lên EKS.</li>
<li>Chúng ta sẽ:</li>
<li>Tạo một DNS domain cho website</li>
<li>Tạo một EKS cluster</li>
<li>Cài <code>cert-manager</code>, tạo TLS certificate</li>
<li>Deploy một web server phục vụ truy cập https từ internet</li>
<li>TLS ở Part 1 chỉ cho mục đích testing</li>
<li>Part 2 chúng ta sẽ cấu hình <code>cert-manager</code> sử dụng <code>Let's Encrypt</code> và <code>Route53 DNS</code> để tạo một <code>trusted certificate</code> có thể sử dụng trên production.</li>
</ul>
<h3 id="cau-hinh-aws-cli">Cấu hình AWS CLI</h3>
<ul>
<li>Coi như đã biết :D</li>
</ul>
<h3 id="tao-mot-public-domain-name">Tạo một public domain name</h3>
<ul>
<li>Mua một public domain name để cấu hình https cho nó.</li>
<li>Lưu lại như một biến env:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DOMAIN_NAME</span><span class="o">=</span>example.com<span class="w"> </span><span class="c1"># ❗ Replace this with your own DNS domain name</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Tạo một Route53 hosted zone:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>aws<span class="w"> </span>route53<span class="w"> </span>create-hosted-zone<span class="w"> </span>--caller-reference<span class="w"> </span><span class="k">$(</span>uuidgen<span class="k">)</span><span class="w"> </span>--name<span class="w"> </span><span class="nv">$DOMAIN_NAME</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Output sẽ ntn:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="o">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="s2">&quot;Location&quot;</span>:<span class="w"> </span><span class="s2">&quot;https://route53.amazonaws.com/2013-04-01/hostedzone/Z0984294TRL0R8AT3SQA&quot;</span>,
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="s2">&quot;HostedZone&quot;</span>:<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">        </span><span class="s2">&quot;Id&quot;</span>:<span class="w"> </span><span class="s2">&quot;/hostedzone/Z0984294TRL0R8AT3SQA&quot;</span>,
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">        </span><span class="s2">&quot;Name&quot;</span>:<span class="w"> </span><span class="s2">&quot;cert-manager-aws-tutorial.richard-gcp.jetstacker.net.&quot;</span>,
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">        </span><span class="s2">&quot;CallerReference&quot;</span>:<span class="w"> </span><span class="s2">&quot;77274711-b648-4da5-81b7-74512897d0db&quot;</span>,
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">        </span><span class="s2">&quot;Config&quot;</span>:<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">            </span><span class="s2">&quot;PrivateZone&quot;</span>:<span class="w"> </span><span class="nb">false</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">        </span><span class="o">}</span>,
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">        </span><span class="s2">&quot;ResourceRecordSetCount&quot;</span>:<span class="w"> </span><span class="m">2</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">    </span><span class="o">}</span>,
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="s2">&quot;ChangeInfo&quot;</span>:<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">        </span><span class="s2">&quot;Id&quot;</span>:<span class="w"> </span><span class="s2">&quot;/change/C04685872DX6N6587E1TL&quot;</span>,
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">        </span><span class="s2">&quot;Status&quot;</span>:<span class="w"> </span><span class="s2">&quot;PENDING&quot;</span>,
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">        </span><span class="s2">&quot;SubmittedAt&quot;</span>:<span class="w"> </span><span class="s2">&quot;2024-09-03T16:29:11.960000+00:00&quot;</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="o">}</span>,
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="s2">&quot;DelegationSet&quot;</span>:<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">        </span><span class="s2">&quot;NameServers&quot;</span>:<span class="w"> </span><span class="o">[</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">            </span><span class="s2">&quot;ns-1504.awsdns-60.org&quot;</span>,
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">            </span><span class="s2">&quot;ns-538.awsdns-03.net&quot;</span>,
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">            </span><span class="s2">&quot;ns-278.awsdns-34.com&quot;</span>,
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">            </span><span class="s2">&quot;ns-1765.awsdns-28.co.uk&quot;</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">        </span><span class="o">]</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Đăng nhập vào control panel của nhà cung cấp domain chúng ta vừa mua và thêm các bản ghi NS từ: <a href="https://www.cloudflare.com/en-gb/learning/dns/dns-server-types/">authoritative DNS servers</a> for Route53 hosted zone ( phần <code>NameServers</code> trong output trên)</li>
<li>Hoặc nếu không có thể tìm lại bằng cách:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nv">HOSTED_ZONE_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>route53<span class="w"> </span>list-hosted-zones-by-name<span class="w"> </span>--dns-name<span class="w"> </span><span class="nv">$DOMAIN_NAME</span><span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;HostedZones[0].Id&quot;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>aws<span class="w"> </span>route53<span class="w"> </span>get-hosted-zone<span class="w"> </span>--id<span class="w"> </span><span class="si">${</span><span class="nv">HOSTED_ZONE_ID</span><span class="si">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Có thể kiểm tra lại bản ghi NS đã được update bằng lệnh <code>dig</code> với "trace":</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>dig<span class="w"> </span><span class="nv">$DOMAIN_NAME</span><span class="w"> </span>ns<span class="w"> </span>+trace<span class="w"> </span>+nodnssec
</code></pre></div></td></tr></table></div>
<ul>
<li>Note: Nó có thể mất lên tới hơn 1 giờ để bản ghi NS được update hoặc thay thế bản ghi NS cũ</li>
</ul>
<h3 id="tao-eks-cluster">Tạo EKS cluster</h3>
<ul>
<li>Tạo EKS cluster bằng <code>eksctl</code></li>
<li>Set env với cluster name:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CLUSTER</span><span class="o">=</span>test-cluster-1
</code></pre></div></td></tr></table></div>
<ul>
<li>Tạo cluster với lệnh sau:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span>
<span class="normal"><a href="#__codelineno-6-6">6</a></span>
<span class="normal"><a href="#__codelineno-6-7">7</a></span>
<span class="normal"><a href="#__codelineno-6-8">8</a></span>
<span class="normal"><a href="#__codelineno-6-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>eksctl<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">  </span>--name<span class="w"> </span><span class="nv">$CLUSTER</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">  </span>--nodegroup-name<span class="w"> </span>node-group-1<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">  </span>--node-type<span class="w"> </span>t3.small<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">  </span>--nodes<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">  </span>--nodes-min<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">  </span>--nodes-max<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">  </span>--managed<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">  </span>--spot
</code></pre></div></td></tr></table></div>
<ul>
<li>Sẽ tốn thời gian để tạo cluster EKS, region tạo tương ứng với region setup trong step AWS CLI</li>
</ul>
<h3 id="install-cert-manager">Install cert-manager</h3>
<ul>
<li>Cài đặt và cấu hình <code>cert-manager</code> thôi:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>helm<span class="w"> </span>install<span class="w"> </span>cert-manager<span class="w"> </span>cert-manager<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span>--repo<span class="w"> </span>https://charts.jetstack.io<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">  </span>--namespace<span class="w"> </span>cert-manager<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">  </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">  </span>--set<span class="w"> </span>crds.enabled<span class="o">=</span><span class="nb">true</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Step trên sẽ cài đặt deployments, services và pods trong namespace: <code>cert-manager</code>.</li>
<li>Nó cũng sẽ cài đặt một vài tài nguyên hỗ trợ khác trong phạm vi cluster như: <code>RBAC</code> roles và <code>Custom Resource Definitions</code>(aka: CRD).</li>
<li>Chúng ta có thể xem các resource đã được cài:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>cert-manager<span class="w"> </span>get<span class="w"> </span>all
</code></pre></div></td></tr></table></div>
<ul>
<li>Có thể explore CRD (cert-manager's API) sử dụng <code>kubectl explain</code>:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>kubectl<span class="w"> </span>explain<span class="w"> </span>Certificate
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>kubectl<span class="w"> </span>explain<span class="w"> </span>CertificateRequest
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>kubectl<span class="w"> </span>explain<span class="w"> </span>Issuer
</code></pre></div></td></tr></table></div>
<h3 id="create-a-test-clusterissuer-and-a-certificate">Create a test ClusterIssuer and a Certificate</h3>
<ul>
<li>Phần này là self-signed certificate ( phần 2 chúng ta sẽ thay thế bằng Let's Encrypt để tạo cert)</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">clusterissuer-selfsigned.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>apiVersion: cert-manager.io/v1
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>kind: ClusterIssuer
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>metadata:
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>  name: selfsigned
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>spec:
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>  selfSigned: {}
</code></pre></div></td></tr></table></div>
<ul>
<li>Apply cấu hình:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>clusterissuer-selfsigned.yaml
</code></pre></div></td></tr></table></div>
<ul>
<li>Tạo certificate:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">certificate.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Certificate</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">  </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www-tls</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">  </span><span class="nt">privateKey</span><span class="p">:</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">    </span><span class="nt">rotationPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">  </span><span class="nt">commonName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.$DOMAIN_NAME</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">  </span><span class="nt">dnsNames</span><span class="p">:</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.$DOMAIN_NAME</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="w">  </span><span class="nt">usages</span><span class="p">:</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">digital signature</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">key encipherment</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server auth</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="w">  </span><span class="nt">issuerRef</span><span class="p">:</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">selfsigned</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Apply cấu hình với <code>envsubst</code> ( sẽ thay thế biến môi trường với giá trị của biến):</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a>envsubst<span class="w"> </span>&lt;<span class="w"> </span>certificate.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>-
</code></pre></div></td></tr></table></div>
<ul>
<li>Dùng <code>cmctl status certificate</code> để check status của Certificate (?) what is this :D</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a>cmctl<span class="w"> </span>status<span class="w"> </span>certificate<span class="w"> </span>www
</code></pre></div></td></tr></table></div>
<ul>
<li>Nếu thành công: private key và signed certificate sẽ được lưu trong Secret tên: <code>www-tls</code>. Có thể sử dụng <code>cmctl inspect secret www-tls</code> để decode base64 xem nội dung Secret:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a>$<span class="w"> </span>cmctl<span class="w"> </span>inspect<span class="w"> </span>secret<span class="w"> </span>www-tls
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>...
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>Valid<span class="w"> </span><span class="k">for</span>:
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">        </span>DNS<span class="w"> </span>Names:
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">                </span>-<span class="w"> </span>www.cert-manager-aws-tutorial.richard-gcp.jetstacker.net
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">        </span>URIs:<span class="w"> </span>&lt;none&gt;
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">        </span>IP<span class="w"> </span>Addresses:<span class="w"> </span>&lt;none&gt;
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">        </span>Email<span class="w"> </span>Addresses:<span class="w"> </span>&lt;none&gt;
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">        </span>Usages:
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">                </span>-<span class="w"> </span>digital<span class="w"> </span>signature
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">                </span>-<span class="w"> </span>key<span class="w"> </span>encipherment
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">                </span>-<span class="w"> </span>server<span class="w"> </span>auth
<a id="__codelineno-15-13" name="__codelineno-15-13"></a>...
</code></pre></div></td></tr></table></div>
<h3 id="deploy-a-sample-web-server">Deploy a sample web server</h3>
<ul>
<li>Deploy một web đơn giản, TLS key và certificate được cung cấp cho web server sử dụng: <code>www-tls</code> secret được mount vào như một volume:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">deployment.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span>
<span class="normal"><a href="#__codelineno-16-27">27</a></span>
<span class="normal"><a href="#__codelineno-16-28">28</a></span>
<span class="normal"><a href="#__codelineno-16-29">29</a></span>
<span class="normal"><a href="#__codelineno-16-30">30</a></span>
<span class="normal"><a href="#__codelineno-16-31">31</a></span>
<span class="normal"><a href="#__codelineno-16-32">32</a></span>
<span class="normal"><a href="#__codelineno-16-33">33</a></span>
<span class="normal"><a href="#__codelineno-16-34">34</a></span>
<span class="normal"><a href="#__codelineno-16-35">35</a></span>
<span class="normal"><a href="#__codelineno-16-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helloweb</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">      </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">        </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hello-app</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-docker.pkg.dev/google-samples/containers/gke/hello-app-tls:1.0</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/tls</span>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a><span class="w">              </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-16-28" name="__codelineno-16-28"></a><span class="w">          </span><span class="nt">env</span><span class="p">:</span>
<a id="__codelineno-16-29" name="__codelineno-16-29"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TLS_CERT</span>
<a id="__codelineno-16-30" name="__codelineno-16-30"></a><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/tls/tls.crt</span>
<a id="__codelineno-16-31" name="__codelineno-16-31"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TLS_KEY</span>
<a id="__codelineno-16-32" name="__codelineno-16-32"></a><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/tls/tls.key</span>
<a id="__codelineno-16-33" name="__codelineno-16-33"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-16-34" name="__codelineno-16-34"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls</span>
<a id="__codelineno-16-35" name="__codelineno-16-35"></a><span class="w">          </span><span class="nt">secret</span><span class="p">:</span>
<a id="__codelineno-16-36" name="__codelineno-16-36"></a><span class="w">            </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www-tls</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Apply cấu hình:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deployment.yaml
</code></pre></div></td></tr></table></div>
<ul>
<li>Chúng ta tạo k8s loadbalancer service giúp kết nối từ internet có thể truy cập được pod. Khi tạo k8s service như dưới, một AWS classic loadbalancer với một ephemeral public IP cũng sẽ được khởi tạo:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">service.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helloweb</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">    </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Apply cấu hình:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>service.yaml
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>Sau 2, 3 phút loadbalancer sẽ được tạo với một public IP. Dùng lệnh: <code>kubectl get service helloweb</code> để kiểm tra.</p>
</li>
<li>
<p><strong><em>Note</em></strong>: Mặc định EKS tạo classic load balancers cho service trong k8s bằng: <a href="https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html#lbc-legacy">Legacy Cloud Provider Load balancer Controller</a>. Tuy nhiên nó dần trở nên di sản (legacy) và chỉ được support critical bug. Theo <a href="https://docs.aws.amazon.com/eks/latest/best-practices/introduction.html">EKS Best Practices Guide</a> chúng ta nên xem xét sử dụng <a href="https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html">AWS Load Balancer Controller</a> thay thế.</p>
</li>
<li>
<p>Stable DNS host name của load balancer có thể sử dụng như bản ghi <code>www</code> của <code>$DOMAIN</code> bằng cách tạo Route53 Alias Record:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="nv">HOSTED_ZONE_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>route53<span class="w"> </span>list-hosted-zones-by-name<span class="w"> </span>--dns-name<span class="w"> </span><span class="nv">$DOMAIN_NAME</span><span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;HostedZones[0].Id&quot;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="nv">ELB_CANONICAL_HOSTED_ZONE_NAME</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>helloweb<span class="w"> </span>--output<span class="o">=</span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{ .status.loadBalancer.ingress[0].hostname }&#39;</span><span class="k">)</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>aws<span class="w"> </span>elb<span class="w"> </span>describe-load-balancers<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;LoadBalancerDescriptions[?CanonicalHostedZoneName == &#39;</span><span class="nv">$ELB_CANONICAL_HOSTED_ZONE_NAME</span><span class="s2">&#39;] | [0]&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;{</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="s1">  &quot;Comment&quot;: &quot;Creating an alias record&quot;,</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="s1">  &quot;Changes&quot;: [</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="s1">    {</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="s1">      &quot;Action&quot;: &quot;CREATE&quot;,</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="s1">      &quot;ResourceRecordSet&quot;: {</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="s1">        &quot;Name&quot;: &quot;www.\($DOMAIN_NAME)&quot;,</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="s1">        &quot;Type&quot;: &quot;A&quot;,</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="s1">        &quot;AliasTarget&quot;: {</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="s1">          &quot;HostedZoneId&quot;: .CanonicalHostedZoneNameID,</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="s1">          &quot;DNSName&quot;: .CanonicalHostedZoneName,</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="s1">          &quot;EvaluateTargetHealth&quot;: false</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="s1">        }</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="s1">      }</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="s1">    }</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="s1">  ]</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="s1">}&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">    </span>--arg<span class="w"> </span>DOMAIN_NAME<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOMAIN_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="p">|</span><span class="w"> </span>aws<span class="w"> </span>route53<span class="w"> </span>change-resource-record-sets<span class="w"> </span>--hosted-zone-id<span class="w"> </span><span class="nv">$HOSTED_ZONE_ID</span><span class="w"> </span>--change-batch<span class="w"> </span>file:///dev/stdin
</code></pre></div></td></tr></table></div>
<ul>
<li>Một cách khác là có thể sử dụng <a href="https://kubernetes-sigs.github.io/external-dns/latest/#what-it-does">ExternalDNS</a></li>
<li>Kiểm tra lại: <code>www.$DOMAIN_NAME</code> giờ có thể resolved ephemeral public IP của service:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span>
<span class="normal"><a href="#__codelineno-21-6">6</a></span>
<span class="normal"><a href="#__codelineno-21-7">7</a></span>
<span class="normal"><a href="#__codelineno-21-8">8</a></span>
<span class="normal"><a href="#__codelineno-21-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a>$<span class="w"> </span>dig<span class="w"> </span>www.<span class="nv">$DOMAIN_NAME</span><span class="w"> </span>A
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>...
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="p">;;</span><span class="w"> </span>QUESTION<span class="w"> </span>SECTION:
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="p">;</span>www.cert-manager-aws-tutorial.richard-gcp.jetstacker.net.<span class="w"> </span>IN<span class="w"> </span>A
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="p">;;</span><span class="w"> </span>ANSWER<span class="w"> </span>SECTION:
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>www.cert-manager-aws-tutorial.richard-gcp.jetstacker.net.<span class="w"> </span><span class="m">60</span><span class="w"> </span>IN<span class="w"> </span>A<span class="w"> </span><span class="m">34</span>.212.236.229
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>www.cert-manager-aws-tutorial.richard-gcp.jetstacker.net.<span class="w"> </span><span class="m">60</span><span class="w"> </span>IN<span class="w"> </span>A<span class="w"> </span><span class="m">44</span>.232.234.71
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>www.cert-manager-aws-tutorial.richard-gcp.jetstacker.net.<span class="w"> </span><span class="m">60</span><span class="w"> </span>IN<span class="w"> </span>A<span class="w"> </span><span class="m">35</span>.164.69.198
</code></pre></div></td></tr></table></div>
<ul>
<li>Nếu DNS đúng, loadbalancers hoạt động và helloworld đang chạy chúng ta nên có thể truy cập được dịch vụ:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a>curl<span class="w"> </span>--insecure<span class="w"> </span>-v<span class="w"> </span>https://www.<span class="nv">$DOMAIN_NAME</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Chúng ta dùng <code>--insecure</code> vì curl sẽ reject untrusted certificate do chúng ta tự gen trước đó. Part 2 chúng ta sẽ dùng Let's Encrypt để gen.</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a>..
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>*<span class="w"> </span>Server<span class="w"> </span>certificate:
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>*<span class="w">  </span>subject:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>www.cert-manager-aws-tutorial.richard-gcp.jetstacker.net
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>*<span class="w">  </span>start<span class="w"> </span>date:<span class="w"> </span>Sep<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">08</span>:43:56<span class="w"> </span><span class="m">2024</span><span class="w"> </span>GMT
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>*<span class="w">  </span>expire<span class="w"> </span>date:<span class="w"> </span>Dec<span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">08</span>:43:56<span class="w"> </span><span class="m">2024</span><span class="w"> </span>GMT
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>*<span class="w">  </span>issuer:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>www.cert-manager-aws-tutorial.richard-gcp.jetstacker.net
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>*<span class="w">  </span>SSL<span class="w"> </span>certificate<span class="w"> </span>verify<span class="w"> </span>result:<span class="w"> </span>self-signed<span class="w"> </span>certificate<span class="w"> </span><span class="o">(</span><span class="m">18</span><span class="o">)</span>,<span class="w"> </span>continuing<span class="w"> </span>anyway.
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>...
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>Hello,<span class="w"> </span>world!
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>Protocol:<span class="w"> </span>HTTP/2.0!
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>Hostname:<span class="w"> </span>helloweb-55cb4cd887-tjlvh
</code></pre></div></td></tr></table></div>
<h2 id="part-2">Part 2</h2>
<ul>
<li>Phần 1 chúng ta tạo certificate test. Phần này sẽ học cách cấu hình cert-manager dùng Let's Encrypt và AWS Route53 DNS để tạo trusted certificate có thể dùng cho môi trường production.</li>
<li>Chúng ta cần chứng minh với Let's Encrypt rằng chúng ta sở hữu domain mà chúng ta sẽ request tạo cert, bằng cách tạo một bản ghi DNS record trong domain này. Cách này được biết đến như: <a href="https://letsencrypt.org/docs/challenge-types/#dns-01-challenge">DNS-01 challenge type</a></li>
<li><code>cert-manager</code> có thể tạo bản ghi DNS này bằng cách sử dụng API của Route53 nhưng nó cần authen trước và cách bảo mật nhất hiện nay là sử dụng AWS Role với service account k8s.</li>
</ul>
<h3 id="create-an-iam-oidc-provider-for-your-cluster">Create an IAM OIDC provider for your cluster</h3>
<ul>
<li>Tạo 1 OIDC ( open ID connect) cho cluster:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>eksctl<span class="w"> </span>utils<span class="w"> </span>associate-iam-oidc-provider<span class="w"> </span>--cluster<span class="w"> </span><span class="nv">$CLUSTER</span><span class="w"> </span>--approve
</code></pre></div></td></tr></table></div>
<h3 id="create-an-iam-policy">Create an IAM policy</h3>
<ul>
<li>Tạo một IAM policy</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span>
<span class="normal"><a href="#__codelineno-25-20">20</a></span>
<span class="normal"><a href="#__codelineno-25-21">21</a></span>
<span class="normal"><a href="#__codelineno-25-22">22</a></span>
<span class="normal"><a href="#__codelineno-25-23">23</a></span>
<span class="normal"><a href="#__codelineno-25-24">24</a></span>
<span class="normal"><a href="#__codelineno-25-25">25</a></span>
<span class="normal"><a href="#__codelineno-25-26">26</a></span>
<span class="normal"><a href="#__codelineno-25-27">27</a></span>
<span class="normal"><a href="#__codelineno-25-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a>aws<span class="w"> </span>iam<span class="w"> </span>create-policy<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">     </span>--policy-name<span class="w"> </span>cert-manager-acme-dns01-route53<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">     </span>--description<span class="w"> </span><span class="s2">&quot;This policy allows cert-manager to manage ACME DNS01 records in Route53 hosted zones. See https://cert-manager.io/docs/configuration/acme/dns01/route53&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">     </span>--policy-document<span class="w"> </span>file:///dev/stdin<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="s">{</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="s">  &quot;Version&quot;: &quot;2012-10-17&quot;,</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="s">  &quot;Statement&quot;: [</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="s">    {</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="s">      &quot;Effect&quot;: &quot;Allow&quot;,</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="s">      &quot;Action&quot;: &quot;route53:GetChange&quot;,</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="s">      &quot;Resource&quot;: &quot;arn:aws:route53:::change/*&quot;</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="s">    },</span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="s">    {</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="s">      &quot;Effect&quot;: &quot;Allow&quot;,</span>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="s">      &quot;Action&quot;: [</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a><span class="s">        &quot;route53:ChangeResourceRecordSets&quot;,</span>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a><span class="s">        &quot;route53:ListResourceRecordSets&quot;</span>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="s">      ],</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><span class="s">      &quot;Resource&quot;: &quot;arn:aws:route53:::hostedzone/*&quot;</span>
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><span class="s">    },</span>
<a id="__codelineno-25-21" name="__codelineno-25-21"></a><span class="s">    {</span>
<a id="__codelineno-25-22" name="__codelineno-25-22"></a><span class="s">      &quot;Effect&quot;: &quot;Allow&quot;,</span>
<a id="__codelineno-25-23" name="__codelineno-25-23"></a><span class="s">      &quot;Action&quot;: &quot;route53:ListHostedZonesByName&quot;,</span>
<a id="__codelineno-25-24" name="__codelineno-25-24"></a><span class="s">      &quot;Resource&quot;: &quot;*&quot;</span>
<a id="__codelineno-25-25" name="__codelineno-25-25"></a><span class="s">    }</span>
<a id="__codelineno-25-26" name="__codelineno-25-26"></a><span class="s">  ]</span>
<a id="__codelineno-25-27" name="__codelineno-25-27"></a><span class="s">}</span>
<a id="__codelineno-25-28" name="__codelineno-25-28"></a><span class="s">EOF</span>
</code></pre></div></td></tr></table></div>
<h3 id="create-an-iam-role-and-associate-it-with-a-kubernetes-service-account">Create an IAM role and associate it with a Kubernetes service account</h3>
<ul>
<li>Bước này sẽ làm các task:</li>
<li>Tạo một service account trong namespace: <code>cert-manager</code>,</li>
<li>Cấu hình một role mới với quyền trong policy được tạo ở bước trên</li>
<li>cấu hình role chỉ có thể assume bởi service account trước đó</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span>
<span class="normal"><a href="#__codelineno-26-6">6</a></span>
<span class="normal"><a href="#__codelineno-26-7">7</a></span>
<span class="normal"><a href="#__codelineno-26-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="nv">AWS_ACCOUNT_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>sts<span class="w"> </span>get-caller-identity<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;Account&quot;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>eksctl<span class="w"> </span>create<span class="w"> </span>iamserviceaccount<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">  </span>--name<span class="w"> </span>cert-manager-acme-dns01-route53<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">  </span>--namespace<span class="w"> </span>cert-manager<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">  </span>--cluster<span class="w"> </span><span class="si">${</span><span class="nv">CLUSTER</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">  </span>--role-name<span class="w"> </span>cert-manager-acme-dns01-route53<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">  </span>--attach-policy-arn<span class="w"> </span>arn:aws:iam::<span class="si">${</span><span class="nv">AWS_ACCOUNT_ID</span><span class="si">}</span>:policy/cert-manager-acme-dns01-route53<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">  </span>--approve
</code></pre></div></td></tr></table></div>
<h3 id="grant-permission-for-cert-manager-to-create-serviceaccount-tokens">Grant permission for cert-manager to create ServiceAccount tokens</h3>
<ul>
<li><code>cert-manager</code> cần quyền để genenrate JWT token cho service account được tạo ở trên. Apply RBAC Role và RoleBinding phía dưới trong namespace: <code>cert-manager</code>:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">rbac.yml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span>
<span class="normal"><a href="#__codelineno-27-17">17</a></span>
<span class="normal"><a href="#__codelineno-27-18">18</a></span>
<span class="normal"><a href="#__codelineno-27-19">19</a></span>
<span class="normal"><a href="#__codelineno-27-20">20</a></span>
<span class="normal"><a href="#__codelineno-27-21">21</a></span>
<span class="normal"><a href="#__codelineno-27-22">22</a></span>
<span class="normal"><a href="#__codelineno-27-23">23</a></span>
<span class="normal"><a href="#__codelineno-27-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a>apiVersion: rbac.authorization.k8s.io/v1
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>kind: Role
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>metadata:
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>  name: cert-manager-acme-dns01-route53-tokenrequest
<a id="__codelineno-27-5" name="__codelineno-27-5"></a>  namespace: cert-manager
<a id="__codelineno-27-6" name="__codelineno-27-6"></a>rules:
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>  - apiGroups: [&quot;&quot;]
<a id="__codelineno-27-8" name="__codelineno-27-8"></a>    resources: [&quot;serviceaccounts/token&quot;]
<a id="__codelineno-27-9" name="__codelineno-27-9"></a>    resourceNames: [&quot;cert-manager-acme-dns01-route53&quot;]
<a id="__codelineno-27-10" name="__codelineno-27-10"></a>    verbs: [&quot;create&quot;]
<a id="__codelineno-27-11" name="__codelineno-27-11"></a>---
<a id="__codelineno-27-12" name="__codelineno-27-12"></a>apiVersion: rbac.authorization.k8s.io/v1
<a id="__codelineno-27-13" name="__codelineno-27-13"></a>kind: RoleBinding
<a id="__codelineno-27-14" name="__codelineno-27-14"></a>metadata:
<a id="__codelineno-27-15" name="__codelineno-27-15"></a>  name: cert-manager-acme-dns01-route53-tokenrequest
<a id="__codelineno-27-16" name="__codelineno-27-16"></a>  namespace: cert-manager
<a id="__codelineno-27-17" name="__codelineno-27-17"></a>subjects:
<a id="__codelineno-27-18" name="__codelineno-27-18"></a>  - kind: ServiceAccount
<a id="__codelineno-27-19" name="__codelineno-27-19"></a>    name: cert-manager
<a id="__codelineno-27-20" name="__codelineno-27-20"></a>    namespace: cert-manager
<a id="__codelineno-27-21" name="__codelineno-27-21"></a>roleRef:
<a id="__codelineno-27-22" name="__codelineno-27-22"></a>  apiGroup: rbac.authorization.k8s.io
<a id="__codelineno-27-23" name="__codelineno-27-23"></a>  kind: Role
<a id="__codelineno-27-24" name="__codelineno-27-24"></a>  name: cert-manager-acme-dns01-route53-tokenrequest
</code></pre></div></td></tr></table></div>
<ul>
<li>Apply:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>rbac.yaml
</code></pre></div></td></tr></table></div>
<h3 id="create-a-clusterissuer-for-lets-encrypt-staging">Create a ClusterIssuer for Let's Encrypt Staging</h3>
<ul>
<li><code>ClusterIssuer</code> là một custom resource nói cho <code>cert-manager</code> cách ký (sign) một certificate. Phần này chúng ta sẽ tạo một <code>ClusterIssuer</code> cấu hình kết nối đến Let's Encrypt staging server, giúp chúng ta kiểm thử mọi thứ mà không bị giới hạn (Let's Encrypt cho môi trường production có giới hạn số lần request)</li>
<li>Tạo file <code>clusterissuer-lets-encrypt-staging.yaml</code> như dưới:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">clusterissuer-lets-encrypt-staging.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span>
<span class="normal"><a href="#__codelineno-29-12">12</a></span>
<span class="normal"><a href="#__codelineno-29-13">13</a></span>
<span class="normal"><a href="#__codelineno-29-14">14</a></span>
<span class="normal"><a href="#__codelineno-29-15">15</a></span>
<span class="normal"><a href="#__codelineno-29-16">16</a></span>
<span class="normal"><a href="#__codelineno-29-17">17</a></span>
<span class="normal"><a href="#__codelineno-29-18">18</a></span>
<span class="normal"><a href="#__codelineno-29-19">19</a></span>
<span class="normal"><a href="#__codelineno-29-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1"># clusterissuer-lets-encrypt-staging.yaml</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-staging</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="w">  </span><span class="nt">acme</span><span class="p">:</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://acme-staging-v02.api.letsencrypt.org/directory</span>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">    </span><span class="nt">email</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${EMAIL_ADDRESS}</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">    </span><span class="nt">privateKeySecretRef</span><span class="p">:</span>
<a id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-staging</span>
<a id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="w">    </span><span class="nt">solvers</span><span class="p">:</span>
<a id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dns01</span><span class="p">:</span>
<a id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="w">          </span><span class="nt">route53</span><span class="p">:</span>
<a id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="w">            </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${AWS_DEFAULT_REGION}</span>
<a id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="w">            </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${AWS_ACCOUNT_ID}:role/cert-manager-acme-dns01-route53</span>
<a id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w">            </span><span class="nt">auth</span><span class="p">:</span>
<a id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="w">              </span><span class="nt">kubernetes</span><span class="p">:</span>
<a id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w">                </span><span class="nt">serviceAccountRef</span><span class="p">:</span>
<a id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="w">                  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager-acme-dns01-route53</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Đổi email với <code>email</code> của chúng ta, và apply cấu hình, một vài biến đã được định nghĩa trong các phần trên:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">EMAIL_ADDRESS</span><span class="o">=</span>&lt;email-address&gt;<span class="w"> </span><span class="c1"># ❗ Replace this with your email address</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ACCOUNT_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>sts<span class="w"> </span>get-caller-identity<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;Account&quot;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>envsubst<span class="w"> </span>&lt;<span class="w"> </span>clusterissuer-lets-encrypt-staging.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w">  </span>-
</code></pre></div></td></tr></table></div>
<ul>
<li>Chúng ta có thể check lại status của ClusterIssuer:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>clusterissuer<span class="w"> </span>letsencrypt-staging
</code></pre></div></td></tr></table></div>
<ul>
<li>Output trông sẽ ntn:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a>Status:
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="w">  </span>Acme:
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">    </span>Last<span class="w"> </span>Registered<span class="w"> </span>Email:<span class="w">  </span>firstname.lastname@example.com
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">    </span>Uri:<span class="w">                    </span>https://acme-staging-v02.api.letsencrypt.org/acme/acct/77882854
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">  </span>Conditions:
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="w">    </span>Last<span class="w"> </span>Transition<span class="w"> </span>Time:<span class="w">  </span><span class="m">2024</span>-09-04T15:41:18Z
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="w">    </span>Message:<span class="w">               </span>The<span class="w"> </span>ACME<span class="w"> </span>account<span class="w"> </span>was<span class="w"> </span>registered<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>ACME<span class="w"> </span>server
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="w">    </span>Observed<span class="w"> </span>Generation:<span class="w">   </span><span class="m">1</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="w">    </span>Reason:<span class="w">                </span>ACMEAccountRegistered
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="w">    </span>Status:<span class="w">                </span>True
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="w">    </span>Type:<span class="w">                  </span>Ready
</code></pre></div></td></tr></table></div>
<ul>
<li>Note:</li>
<li>Let's Encrypt dùng giao thức Automatic Certificate Management Environment (ACME) đó là lý do tại sao yaml file trên có key: <code>acme</code></li>
<li>Email: dùng để Let's Encrypt remind chúng ta làm mới cert 30 ngày trước khi cert expired.</li>
<li>Let's Encrypt cho production có giới hạn tỷ lệ rất nghiêm ngặt rất dễ bị chạm ngưỡng giới hạn này nên chúng ta test với staging trước</li>
</ul>
<h3 id="re-issue-the-certificate-using-lets-encrypt">Re-issue the Certificate using Let's Encrypt</h3>
<ul>
<li>Patch lại cert sử dụng ClussterIssuer của staging:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a>kubectl<span class="w"> </span>patch<span class="w"> </span>certificate<span class="w"> </span>www<span class="w"> </span>--type<span class="w"> </span>merge<span class="w">  </span>-p<span class="w"> </span><span class="s1">&#39;{&quot;spec&quot;:{&quot;issuerRef&quot;:{&quot;name&quot;:&quot;letsencrypt-staging&quot;}}}&#39;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Việc này sẽ trigger <code>cert-manager</code> renew certificate. Dùng lệnh <code>cmctl</code> để check:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a>cmctl<span class="w"> </span>status<span class="w"> </span>certificate<span class="w"> </span>www
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>cmctl<span class="w"> </span>inspect<span class="w"> </span>secret<span class="w"> </span>www-tls
</code></pre></div></td></tr></table></div>
<ul>
<li>Khi cert được issued, restart lại web server để apply:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a>kubectl<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment<span class="w"> </span>helloweb
</code></pre></div></td></tr></table></div>
<ul>
<li>Truy cập thử:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a>$<span class="w"> </span>curl<span class="w"> </span>-v<span class="w"> </span>--insecure<span class="w"> </span>https://www.<span class="nv">$DOMAIN_NAME</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>...
<a id="__codelineno-36-3" name="__codelineno-36-3"></a>*<span class="w"> </span>Server<span class="w"> </span>certificate:
<a id="__codelineno-36-4" name="__codelineno-36-4"></a>*<span class="w">  </span>subject:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>www.cert-manager-tutorial-22.site
<a id="__codelineno-36-5" name="__codelineno-36-5"></a>*<span class="w">  </span>start<span class="w"> </span>date:<span class="w"> </span>Jan<span class="w">  </span><span class="m">5</span><span class="w"> </span><span class="m">12</span>:41:14<span class="w"> </span><span class="m">2023</span><span class="w"> </span>GMT
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>*<span class="w">  </span>expire<span class="w"> </span>date:<span class="w"> </span>Apr<span class="w">  </span><span class="m">5</span><span class="w"> </span><span class="m">12</span>:41:13<span class="w"> </span><span class="m">2023</span><span class="w"> </span>GMT
<a id="__codelineno-36-7" name="__codelineno-36-7"></a>*<span class="w">  </span>issuer:<span class="w"> </span><span class="nv">C</span><span class="o">=</span>US<span class="p">;</span><span class="w"> </span><span class="nv">O</span><span class="o">=(</span>STAGING<span class="o">)</span><span class="w"> </span>Let<span class="err">&#39;</span>s<span class="w"> </span>Encrypt<span class="p">;</span><span class="w"> </span><span class="nv">CN</span><span class="o">=(</span>STAGING<span class="o">)</span><span class="w"> </span>Artificial<span class="w"> </span>Apricot<span class="w"> </span>R3
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>*<span class="w">  </span>SSL<span class="w"> </span>certificate<span class="w"> </span>verify<span class="w"> </span>result:<span class="w"> </span>unable<span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span><span class="nb">local</span><span class="w"> </span>issuer<span class="w"> </span>certificate<span class="w"> </span><span class="o">(</span><span class="m">20</span><span class="o">)</span>,<span class="w"> </span>continuing<span class="w"> </span>anyway.
<a id="__codelineno-36-9" name="__codelineno-36-9"></a>...
<a id="__codelineno-36-10" name="__codelineno-36-10"></a>Hello,<span class="w"> </span>world!
<a id="__codelineno-36-11" name="__codelineno-36-11"></a>Protocol:<span class="w"> </span>HTTP/2.0!
<a id="__codelineno-36-12" name="__codelineno-36-12"></a>Hostname:<span class="w"> </span>helloweb-9b8bcdd56-6rxm8
</code></pre></div></td></tr></table></div>
<h3 id="create-a-production-ready-certificate">Create a production ready certificate</h3>
<ul>
<li>Staging works as expected :D chuyển qua production thôi.</li>
<li>Tạo một Let's Encrypt production Issuer thôi:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">clusterissuer-lets-encrypt-production.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1"># clusterissuer-lets-encrypt-production.yaml</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a>apiVersion:<span class="w"> </span>cert-manager.io/v1
<a id="__codelineno-37-3" name="__codelineno-37-3"></a>kind:<span class="w"> </span>ClusterIssuer
<a id="__codelineno-37-4" name="__codelineno-37-4"></a>metadata:
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="w">  </span>name:<span class="w"> </span>letsencrypt-production
<a id="__codelineno-37-6" name="__codelineno-37-6"></a>spec:
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w">  </span>acme:
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="w">    </span>server:<span class="w"> </span>https://acme-v02.api.letsencrypt.org/directory
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="w">    </span>email:<span class="w"> </span><span class="nv">$EMAIL_ADDRESS</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="w">    </span>privateKeySecretRef:
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="w">      </span>name:<span class="w"> </span>letsencrypt-production
<a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="w">    </span>solvers:
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="w">    </span>-<span class="w"> </span>dns01:
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w">        </span>route53:
<a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="w">          </span>region:<span class="w"> </span><span class="si">${</span><span class="nv">AWS_DEFAULT_REGION</span><span class="si">}</span>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="w">          </span>role:<span class="w"> </span>arn:aws:iam::<span class="si">${</span><span class="nv">AWS_ACCOUNT_ID</span><span class="si">}</span>:role/cert-manager-acme-dns01-route53
<a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="w">          </span>auth:
<a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="w">            </span>kubernetes:
<a id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="w">              </span>serviceAccountRef:
<a id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="w">                </span>name:<span class="w"> </span>cert-manager-acme-dns01-route53
</code></pre></div></td></tr></table></div>
<ul>
<li>Apply cấu hình:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ACCOUNT_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>sts<span class="w"> </span>get-caller-identity<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;Account&quot;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>envsubst<span class="w"> </span>&lt;<span class="w"> </span>clusterissuer-lets-encrypt-production.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w">  </span>-
</code></pre></div></td></tr></table></div>
<ul>
<li>Check status của ClusterIssuer:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>clusterissuer<span class="w"> </span>letsencrypt-production
</code></pre></div></td></tr></table></div>
<ul>
<li>Patch certificate để dùng production ClusterIssuer:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a>kubectl<span class="w"> </span>patch<span class="w"> </span>certificate<span class="w"> </span>www<span class="w"> </span>--type<span class="w"> </span>merge<span class="w">  </span>-p<span class="w"> </span><span class="s1">&#39;{&quot;spec&quot;:{&quot;issuerRef&quot;:{&quot;name&quot;:&quot;letsencrypt-production&quot;}}}&#39;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Việc này sẽ trigger <code>cert-manager</code> trigger để tạo một certificate mới. Dùng <code>cmctl</code> để check:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a>cmctl<span class="w"> </span>status<span class="w"> </span>certificate<span class="w"> </span>www
<a id="__codelineno-41-2" name="__codelineno-41-2"></a>cmctl<span class="w"> </span>inspect<span class="w"> </span>secret<span class="w"> </span>www-tls
</code></pre></div></td></tr></table></div>
<ul>
<li>Cuối cùng khi cert được gen, restart lại web server thôi:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a>kubectl<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment<span class="w"> </span>helloweb
</code></pre></div></td></tr></table></div>
<ul>
<li>Bây giờ có thể dùng <code>curl</code> mà ko cần option <code>--insecure</code> nữa:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a>curl<span class="w"> </span>-v<span class="w"> </span>https://www.<span class="nv">$DOMAIN_NAME</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a>...
<a id="__codelineno-43-3" name="__codelineno-43-3"></a>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a>*<span class="w"> </span>Server<span class="w"> </span>certificate:
<a id="__codelineno-43-5" name="__codelineno-43-5"></a>*<span class="w">  </span>subject:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>www.cert-manager-aws-tutorial.richard-gcp.jetstacker.net
<a id="__codelineno-43-6" name="__codelineno-43-6"></a>*<span class="w">  </span>start<span class="w"> </span>date:<span class="w"> </span>Sep<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">19</span>:32:24<span class="w"> </span><span class="m">2024</span><span class="w"> </span>GMT
<a id="__codelineno-43-7" name="__codelineno-43-7"></a>*<span class="w">  </span>expire<span class="w"> </span>date:<span class="w"> </span>Dec<span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">19</span>:32:23<span class="w"> </span><span class="m">2024</span><span class="w"> </span>GMT
<a id="__codelineno-43-8" name="__codelineno-43-8"></a>*<span class="w">  </span>subjectAltName:<span class="w"> </span>host<span class="w"> </span><span class="s2">&quot;www.cert-manager-aws-tutorial.richard-gcp.jetstacker.net&quot;</span><span class="w"> </span>matched<span class="w"> </span>cert<span class="s1">&#39;s &quot;www.cert-manager-aws-tutorial.richard-gcp.jetstacker.net&quot;</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="s1">*  issuer: C=US; O=Let&#39;</span>s<span class="w"> </span>Encrypt<span class="p">;</span><span class="w"> </span><span class="nv">CN</span><span class="o">=</span>R11
<a id="__codelineno-43-10" name="__codelineno-43-10"></a>*<span class="w">  </span>SSL<span class="w"> </span>certificate<span class="w"> </span>verify<span class="w"> </span>ok.
<a id="__codelineno-43-11" name="__codelineno-43-11"></a>...
</code></pre></div></td></tr></table></div>
<ul>
<li>Yeah that all! Chúng ta học cách:</li>
<li>Deploy <code>cert-manager</code> lên EKS, cấu hình <code>cert-manager</code> để issue Let's Encrypt signed 1 certificate sử dụng giao thức DNS-01 với Route53.</li>
<li>Chúng ta cũng học về IAM Role for service account (IRSA) và đã học về cách cấu hình <code>cert-manager</code> để authenticate AWS Route53 sử dụng k8s ServiceAccount Token.</li>
</ul>
<h2 id="clean-up">Clean Up</h2>
<ul>
<li>Xoá thôi :D</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a>eksctl<span class="w"> </span>delete<span class="w"> </span>cluster<span class="w"> </span>--name<span class="w"> </span><span class="nv">$CLUSTER</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="nv">HOSTED_ZONE_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>route53<span class="w"> </span>list-hosted-zones-by-name<span class="w"> </span>--dns-name<span class="w"> </span><span class="nv">$DOMAIN_NAME</span><span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;HostedZones[0].Id&quot;</span><span class="w"> </span>--output<span class="w"> </span>text<span class="k">)</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a>aws<span class="w"> </span>route53<span class="w"> </span>delete-hosted-zone<span class="w"> </span>--id<span class="w"> </span><span class="si">${</span><span class="nv">HOSTED_ZONE_ID</span><span class="si">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Happy Devops!!! Xem thêm các link liên quan của GCP và Azure :D</li>
</ul>







  
  




  



      
    </article>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 <a href="https://github.com/fenixpapu"  target="_blank" rel="noopener">PaPu</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/fenixpapu" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/phoenixpapu" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/fenixpapu/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../../..", "features": ["navigation.tabs", "navigation.indexes", "navigation.top", "toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>